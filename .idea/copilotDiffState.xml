<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/dat/controllers/impl/MessageController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/dat/controllers/impl/MessageController.java" />
              <option name="originalContent" value="package dat.controllers.impl;&#10;&#10;import com.fasterxml.jackson.core.JsonParseException;&#10;import com.fasterxml.jackson.databind.exc.InvalidFormatException;&#10;import dat.config.HibernateConfig;&#10;import dat.controllers.IController;&#10;import dat.daos.impl.MessageDAO;&#10;import dat.dtos.MessageDTO;&#10;import dat.exceptions.ApiException;&#10;import io.javalin.http.Context;&#10;import io.javalin.validation.ValidationException;&#10;import jakarta.persistence.EntityManagerFactory;&#10;import jakarta.persistence.EntityNotFoundException;&#10;import jakarta.persistence.NoResultException;&#10;&#10;import java.time.DateTimeException;&#10;import java.util.List;&#10;&#10;public class MessageController implements IController&lt;MessageDTO, Integer&gt; {&#10;    private final MessageDAO dao;&#10;&#10;    public MessageController() {&#10;        EntityManagerFactory emf = HibernateConfig.getEntityManagerFactory();&#10;        this.dao = MessageDAO.getInstance(emf);&#10;    }&#10;&#10;    @Override&#10;    public void readById(Context ctx) {&#10;        try {&#10;            int id = Integer.parseInt(ctx.pathParam(&quot;id&quot;));&#10;&#10;            MessageDTO messageDTO = dao.readById(id);&#10;            ctx.res().setStatus(200);&#10;            ctx.json(messageDTO);&#10;        } catch (IllegalArgumentException e) {&#10;            throw new ApiException(400, &quot;Invalid id: &quot; + ctx.pathParam(&quot;id&quot;));&#10;        } catch (NoResultException | EntityNotFoundException e) {&#10;            throw new ApiException(404, &quot;Message with id &quot; + ctx.pathParam(&quot;id&quot;) + &quot; not found&quot;);&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void readAll(Context ctx) {&#10;        try {&#10;            List&lt;MessageDTO&gt; messageDTOs = dao.readAll();&#10;            ctx.res().setStatus(200);&#10;            ctx.json(messageDTOs);&#10;        } catch (EntityNotFoundException e) {&#10;            throw new ApiException(404, &quot;Messages not found&quot;);&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void create(Context ctx) {&#10;        try {&#10;            MessageDTO jsonRequest = ctx.bodyAsClass(MessageDTO.class);&#10;            MessageDTO createdMessage = dao.create(jsonRequest);&#10;            ctx.res().setStatus(201);&#10;            ctx.json(createdMessage);&#10;        } catch (ApiException e) {&#10;            throw new ApiException(e.getStatusCode(), e.getMessage());&#10;        } catch (Exception e) {&#10;            throw new ApiException(400, e.getMessage());&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void update(Context ctx) {&#10;        try {&#10;            int id = Integer.parseInt(ctx.pathParam(&quot;id&quot;));&#10;&#10;            MessageDTO jsonRequest = ctx.bodyAsClass(MessageDTO.class);&#10;            MessageDTO updatedMessage = dao.update(id, jsonRequest);&#10;            ctx.res().setStatus(201);&#10;            ctx.json(updatedMessage);&#10;        } catch (ApiException e) {&#10;            throw new ApiException(e.getStatusCode(), e.getMessage());&#10;        } catch (NumberFormatException e) {&#10;            throw new ApiException(400, &quot;Invalid id: &quot; + ctx.pathParam(&quot;id&quot;));&#10;        } catch (EntityNotFoundException e) {&#10;            throw new ApiException(404, &quot;Message with id &quot; + ctx.pathParam(&quot;id&quot;) + &quot; not found&quot;);&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void delete(Context ctx) {&#10;        try {&#10;            int id = Integer.parseInt(ctx.pathParam(&quot;id&quot;));&#10;            dao.delete(id);&#10;            ctx.res().setStatus(204);&#10;        } catch (NumberFormatException e) {&#10;            throw new ApiException(400, &quot;Invalid id: &quot; + ctx.pathParam(&quot;id&quot;));&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package dat.controllers.impl;&#10;&#10;import com.fasterxml.jackson.core.JsonParseException;&#10;import com.fasterxml.jackson.databind.exc.InvalidFormatException;&#10;import dat.config.HibernateConfig;&#10;import dat.controllers.IController;&#10;import dat.daos.impl.MessageDAO;&#10;import dat.dtos.MessageDTO;&#10;import dat.exceptions.ApiException;&#10;import io.javalin.http.Context;&#10;import io.javalin.validation.ValidationException;&#10;import jakarta.persistence.EntityManagerFactory;&#10;import jakarta.persistence.EntityNotFoundException;&#10;import jakarta.persistence.NoResultException;&#10;&#10;import java.time.DateTimeException;&#10;import java.util.List;&#10;&#10;public class MessageController implements IController&lt;MessageDTO, Integer&gt; {&#10;    private final MessageDAO dao;&#10;&#10;    public MessageController() {&#10;        EntityManagerFactory emf = HibernateConfig.getEntityManagerFactory();&#10;        this.dao = MessageDAO.getInstance(emf);&#10;    }&#10;&#10;    @Override&#10;    public void readById(Context ctx) {&#10;        try {&#10;            int id = Integer.parseInt(ctx.pathParam(&quot;id&quot;));&#10;&#10;            MessageDTO messageDTO = dao.readById(id);&#10;            ctx.res().setStatus(200);&#10;            ctx.json(messageDTO);&#10;        } catch (IllegalArgumentException e) {&#10;            throw new ApiException(400, &quot;Invalid id: &quot; + ctx.pathParam(&quot;id&quot;));&#10;        } catch (NoResultException | EntityNotFoundException e) {&#10;            throw new ApiException(404, &quot;Message with id &quot; + ctx.pathParam(&quot;id&quot;) + &quot; not found&quot;);&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void readAll(Context ctx) {&#10;        try {&#10;            List&lt;MessageDTO&gt; messageDTOs = dao.readAll();&#10;            ctx.res().setStatus(200);&#10;            ctx.json(messageDTOs);&#10;        } catch (EntityNotFoundException e) {&#10;            throw new ApiException(404, &quot;Messages not found&quot;);&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void create(Context ctx) {&#10;        try {&#10;            MessageDTO jsonRequest = ctx.bodyAsClass(MessageDTO.class);&#10;            MessageDTO createdMessage = dao.create(jsonRequest);&#10;            ctx.res().setStatus(201);&#10;            ctx.json(createdMessage);&#10;        } catch (ApiException e) {&#10;            throw new ApiException(e.getStatusCode(), e.getMessage());&#10;        } catch (Exception e) {&#10;            throw new ApiException(400, e.getMessage());&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void update(Context ctx) {&#10;        try {&#10;            int id = Integer.parseInt(ctx.pathParam(&quot;id&quot;));&#10;&#10;            MessageDTO jsonRequest = ctx.bodyAsClass(MessageDTO.class);&#10;            MessageDTO updatedMessage = dao.update(id, jsonRequest);&#10;            ctx.res().setStatus(201);&#10;            ctx.json(updatedMessage);&#10;        } catch (ApiException e) {&#10;            throw new ApiException(e.getStatusCode(), e.getMessage());&#10;        } catch (NumberFormatException e) {&#10;            throw new ApiException(400, &quot;Invalid id: &quot; + ctx.pathParam(&quot;id&quot;));&#10;        } catch (EntityNotFoundException e) {&#10;            throw new ApiException(404, &quot;Message with id &quot; + ctx.pathParam(&quot;id&quot;) + &quot; not found&quot;);&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void delete(Context ctx) {&#10;        try {&#10;            int id = Integer.parseInt(ctx.pathParam(&quot;id&quot;));&#10;            dao.delete(id);&#10;            ctx.res().setStatus(204);&#10;        } catch (NumberFormatException e) {&#10;            throw new ApiException(400, &quot;Invalid id: &quot; + ctx.pathParam(&quot;id&quot;));&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/dat/daos/impl/MessageDAO.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/dat/daos/impl/MessageDAO.java" />
              <option name="originalContent" value="package dat.daos.impl;&#10;&#10;import dat.daos.IDAO;&#10;import dat.dtos.AttachmentDTO;&#10;import dat.dtos.MessageDTO;&#10;import dat.entities.Attachment;&#10;import dat.entities.Message;&#10;import dat.entities.Ticket;&#10;import dat.entities.User;&#10;import dat.exceptions.ApiException;&#10;import jakarta.persistence.EntityManager;&#10;import jakarta.persistence.EntityManagerFactory;&#10;import jakarta.persistence.EntityNotFoundException;&#10;import jakarta.persistence.TypedQuery;&#10;&#10;import java.util.List;&#10;&#10;public class MessageDAO implements IDAO&lt;MessageDTO, Integer&gt; {&#10;&#10;    private static MessageDAO instance;&#10;    private static EntityManagerFactory emf;&#10;&#10;    public static MessageDAO getInstance(EntityManagerFactory _emf) {&#10;        if (instance == null) {&#10;            emf = _emf;&#10;            instance = new MessageDAO();&#10;        }&#10;        return instance;&#10;    }&#10;&#10;    @Override&#10;    public MessageDTO readById(Integer integer) throws ApiException {&#10;        return null;&#10;    }&#10;&#10;    @Override&#10;    public List&lt;MessageDTO&gt; readAll() {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            TypedQuery&lt;MessageDTO&gt; query = em.createQuery(&quot;SELECT new dat.dtos.MessageDTO(m) FROM Message m&quot;, MessageDTO.class);&#10;            List&lt;MessageDTO&gt; messages = query.getResultList();&#10;            if (messages.isEmpty()) {&#10;                throw new EntityNotFoundException(&quot;No messages found&quot;);&#10;            }&#10;            return messages;&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public MessageDTO create(MessageDTO messageDTO) {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            em.getTransaction().begin();&#10;&#10;            // Fetch the ticket&#10;            Ticket ticket = em.find(Ticket.class, messageDTO.getTicketId());&#10;            if (ticket == null) {&#10;                throw new EntityNotFoundException(&quot;Ticket with id &quot; + messageDTO.getTicketId() + &quot; not found&quot;);&#10;            }&#10;&#10;            // Fetch the author&#10;            User author = em.find(User.class, messageDTO.getAuthor().getId());&#10;            if (author == null) {&#10;                throw new EntityNotFoundException(&quot;User with id &quot; + messageDTO.getAuthor().getId() + &quot; not found&quot;);&#10;            }&#10;&#10;            // Create message entity&#10;            Message message = new Message(ticket, author, messageDTO.isInternalFlag(), messageDTO.getBody());&#10;&#10;            // Add attachments if any&#10;            if (messageDTO.getAttachments() != null &amp;&amp; !messageDTO.getAttachments().isEmpty()) {&#10;                for (AttachmentDTO attDto : messageDTO.getAttachments()) {&#10;                    Attachment attachment = new Attachment(&#10;                            attDto.getFileName(),&#10;                            attDto.getMediaType(),&#10;                            attDto.getSize(),&#10;                            attDto.getUrl(),&#10;                            message&#10;                    );&#10;                    message.getAttachments().add(attachment);&#10;                }&#10;            }&#10;&#10;            // Persist message (cascade will handle attachments)&#10;            em.persist(message);&#10;            ticket.getMessages().add(message); // Maintain bidirectional relationship&#10;            em.getTransaction().commit();&#10;&#10;            return new MessageDTO(message);&#10;        } catch (EntityNotFoundException e) {&#10;            throw new ApiException(404, e.getMessage());&#10;        } catch (Exception e) {&#10;            throw new ApiException(500, &quot;Failed to create message: &quot; + e.getMessage());&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public MessageDTO update(Integer id, MessageDTO messageDTO) throws ApiException {&#10;        return null;&#10;    }&#10;&#10;    @Override&#10;    public void delete(Integer integer) throws ApiException {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            em.getTransaction().begin();&#10;            Message message = em.find(Message.class, integer);&#10;            if (message == null) {&#10;                throw new EntityNotFoundException(&quot;Message with id &quot; + integer + &quot; not found&quot;);&#10;            }&#10;            em.remove(message);&#10;            em.getTransaction().commit();&#10;        } catch (EntityNotFoundException e) {&#10;            throw new ApiException(404, e.getMessage());&#10;        } catch (Exception e) {&#10;            throw new ApiException(500, &quot;Failed to delete message: &quot; + e.getMessage());&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package dat.daos.impl;&#10;&#10;import dat.daos.IDAO;&#10;import dat.dtos.AttachmentDTO;&#10;import dat.dtos.MessageDTO;&#10;import dat.entities.Attachment;&#10;import dat.entities.Message;&#10;import dat.entities.Ticket;&#10;import dat.entities.User;&#10;import dat.exceptions.ApiException;&#10;import jakarta.persistence.EntityManager;&#10;import jakarta.persistence.EntityManagerFactory;&#10;import jakarta.persistence.EntityNotFoundException;&#10;import jakarta.persistence.TypedQuery;&#10;&#10;import java.util.List;&#10;&#10;public class MessageDAO implements IDAO&lt;MessageDTO, Integer&gt; {&#10;&#10;    private static MessageDAO instance;&#10;    private static EntityManagerFactory emf;&#10;&#10;    public static MessageDAO getInstance(EntityManagerFactory _emf) {&#10;        if (instance == null) {&#10;            emf = _emf;&#10;            instance = new MessageDAO();&#10;        }&#10;        return instance;&#10;    }&#10;&#10;    @Override&#10;    public MessageDTO readById(Integer integer) throws ApiException {&#10;        return null;&#10;    }&#10;&#10;    @Override&#10;    public List&lt;MessageDTO&gt; readAll() {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            TypedQuery&lt;MessageDTO&gt; query = em.createQuery(&quot;SELECT new dat.dtos.MessageDTO(m) FROM Message m&quot;, MessageDTO.class);&#10;            List&lt;MessageDTO&gt; messages = query.getResultList();&#10;            if (messages.isEmpty()) {&#10;                throw new EntityNotFoundException(&quot;No messages found&quot;);&#10;            }&#10;            return messages;&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public MessageDTO create(MessageDTO messageDTO) {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            em.getTransaction().begin();&#10;&#10;            // Fetch the ticket&#10;            Ticket ticket = em.find(Ticket.class, messageDTO.getTicketId());&#10;            if (ticket == null) {&#10;                throw new EntityNotFoundException(&quot;Ticket with id &quot; + messageDTO.getTicketId() + &quot; not found&quot;);&#10;            }&#10;&#10;            // Fetch the author&#10;            User author = em.find(User.class, messageDTO.getAuthor().getId());&#10;            if (author == null) {&#10;                throw new EntityNotFoundException(&quot;User with id &quot; + messageDTO.getAuthor().getId() + &quot; not found&quot;);&#10;            }&#10;&#10;            // Create message entity&#10;            Message message = new Message(ticket, author, messageDTO.isInternalFlag(), messageDTO.getBody());&#10;&#10;            // Add attachments if any&#10;            if (messageDTO.getAttachments() != null &amp;&amp; !messageDTO.getAttachments().isEmpty()) {&#10;                for (AttachmentDTO attDto : messageDTO.getAttachments()) {&#10;                    Attachment attachment = new Attachment(&#10;                            attDto.getFileName(),&#10;                            attDto.getMediaType(),&#10;                            attDto.getSize(),&#10;                            attDto.getUrl(),&#10;                            message&#10;                    );&#10;                    message.getAttachments().add(attachment);&#10;                }&#10;            }&#10;&#10;            // Persist message (cascade will handle attachments)&#10;            em.persist(message);&#10;            ticket.getMessages().add(message); // Maintain bidirectional relationship&#10;            em.getTransaction().commit();&#10;&#10;            return new MessageDTO(message);&#10;        } catch (EntityNotFoundException e) {&#10;            throw new ApiException(404, e.getMessage());&#10;        } catch (Exception e) {&#10;            throw new ApiException(500, &quot;Failed to create message: &quot; + e.getMessage());&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public MessageDTO update(Integer id, MessageDTO messageDTO) throws ApiException {&#10;        return null;&#10;    }&#10;&#10;    @Override&#10;    public void delete(Integer integer) throws ApiException {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            em.getTransaction().begin();&#10;            Message message = em.find(Message.class, integer);&#10;            if (message == null) {&#10;                throw new EntityNotFoundException(&quot;Message with id &quot; + integer + &quot; not found&quot;);&#10;            }&#10;            em.remove(message);&#10;            em.getTransaction().commit();&#10;        } catch (EntityNotFoundException e) {&#10;            throw new ApiException(404, e.getMessage());&#10;        } catch (Exception e) {&#10;            throw new ApiException(500, &quot;Failed to delete message: &quot; + e.getMessage());&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/dat/daos/impl/TagDAO.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/dat/daos/impl/TagDAO.java" />
              <option name="originalContent" value="package dat.daos.impl;&#10;&#10;import dat.daos.IDAO;&#10;import dat.dtos.TagDTO;&#10;import dat.entities.Tag;&#10;import dat.exceptions.ApiException;&#10;import jakarta.persistence.EntityManager;&#10;import jakarta.persistence.EntityManagerFactory;&#10;import jakarta.persistence.EntityNotFoundException;&#10;import jakarta.persistence.TypedQuery;&#10;&#10;import java.util.List;&#10;&#10;public class TagDAO implements IDAO&lt;TagDTO, Long&gt; {&#10;&#10;    private static TagDAO instance;&#10;    private static EntityManagerFactory emf;&#10;&#10;    public static TagDAO getInstance(EntityManagerFactory _emf) {&#10;        if (instance == null) {&#10;            emf = _emf;&#10;            instance = new TagDAO();&#10;        }&#10;        return instance;&#10;    }&#10;&#10;    @Override&#10;    public TagDTO readById(Long id) throws ApiException {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            Tag tag = em.find(Tag.class, id);&#10;            if (tag == null) {&#10;                throw new EntityNotFoundException(&quot;Tag with id &quot; + id + &quot; not found&quot;);&#10;            }&#10;            return new TagDTO(tag);&#10;        } catch (EntityNotFoundException e) {&#10;            throw new ApiException(404, e.getMessage());&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public List&lt;TagDTO&gt; readAll() {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            TypedQuery&lt;TagDTO&gt; query = em.createQuery(&#10;                &quot;SELECT new dat.dtos.TagDTO(t) FROM Tag t ORDER BY t.name&quot;, &#10;                TagDTO.class&#10;            );&#10;            List&lt;TagDTO&gt; tags = query.getResultList();&#10;            if (tags.isEmpty()) {&#10;                throw new EntityNotFoundException(&quot;No tags found&quot;);&#10;            }&#10;            return tags;&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public TagDTO create(TagDTO tagDTO) {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            em.getTransaction().begin();&#10;            &#10;            Tag tag = new Tag();&#10;            tag.setName(tagDTO.getName());&#10;            &#10;            em.persist(tag);&#10;            em.getTransaction().commit();&#10;            &#10;            return new TagDTO(tag);&#10;        } catch (Exception e) {&#10;            throw new ApiException(500, &quot;Failed to create tag: &quot; + e.getMessage());&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public TagDTO update(Long id, TagDTO tagDTO) throws ApiException {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            em.getTransaction().begin();&#10;&#10;            Tag tag = em.find(Tag.class, id);&#10;            if (tag == null) {&#10;                throw new EntityNotFoundException(&quot;Tag with id &quot; + id + &quot; not found&quot;);&#10;            }&#10;&#10;            tag.setName(tagDTO.getName());&#10;&#10;            em.getTransaction().commit();&#10;            return new TagDTO(tag);&#10;        } catch (EntityNotFoundException e) {&#10;            throw new ApiException(404, e.getMessage());&#10;        } catch (Exception e) {&#10;            throw new ApiException(500, &quot;Failed to update tag: &quot; + e.getMessage());&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void delete(Long id) throws ApiException {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            em.getTransaction().begin();&#10;            Tag tag = em.find(Tag.class, id);&#10;            if (tag == null) {&#10;                throw new EntityNotFoundException(&quot;Tag with id &quot; + id + &quot; not found&quot;);&#10;            }&#10;            em.remove(tag);&#10;            em.getTransaction().commit();&#10;        } catch (EntityNotFoundException e) {&#10;            throw new ApiException(404, e.getMessage());&#10;        } catch (Exception e) {&#10;            throw new ApiException(500, &quot;Failed to delete tag: &quot; + e.getMessage());&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package dat.daos.impl;&#10;&#10;import dat.daos.IDAO;&#10;import dat.dtos.TagDTO;&#10;import dat.entities.Tag;&#10;import dat.exceptions.ApiException;&#10;import jakarta.persistence.EntityManager;&#10;import jakarta.persistence.EntityManagerFactory;&#10;import jakarta.persistence.EntityNotFoundException;&#10;import jakarta.persistence.TypedQuery;&#10;&#10;import java.util.List;&#10;&#10;public class TagDAO implements IDAO&lt;TagDTO, Long&gt; {&#10;&#10;    private static TagDAO instance;&#10;    private static EntityManagerFactory emf;&#10;&#10;    public static TagDAO getInstance(EntityManagerFactory _emf) {&#10;        if (instance == null) {&#10;            emf = _emf;&#10;            instance = new TagDAO();&#10;        }&#10;        return instance;&#10;    }&#10;&#10;    @Override&#10;    public TagDTO readById(Long id) throws ApiException {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            Tag tag = em.find(Tag.class, id);&#10;            if (tag == null) {&#10;                throw new EntityNotFoundException(&quot;Tag with id &quot; + id + &quot; not found&quot;);&#10;            }&#10;            return new TagDTO(tag);&#10;        } catch (EntityNotFoundException e) {&#10;            throw new ApiException(404, e.getMessage());&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public List&lt;TagDTO&gt; readAll() {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            TypedQuery&lt;TagDTO&gt; query = em.createQuery(&#10;                &quot;SELECT new dat.dtos.TagDTO(t) FROM Tag t ORDER BY t.name&quot;, &#10;                TagDTO.class&#10;            );&#10;            List&lt;TagDTO&gt; tags = query.getResultList();&#10;            if (tags.isEmpty()) {&#10;                throw new EntityNotFoundException(&quot;No tags found&quot;);&#10;            }&#10;            return tags;&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public TagDTO create(TagDTO tagDTO) {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            em.getTransaction().begin();&#10;            &#10;            Tag tag = new Tag();&#10;            tag.setName(tagDTO.getName());&#10;            &#10;            em.persist(tag);&#10;            em.getTransaction().commit();&#10;            &#10;            return new TagDTO(tag);&#10;        } catch (Exception e) {&#10;            throw new ApiException(500, &quot;Failed to create tag: &quot; + e.getMessage());&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public TagDTO update(Long id, TagDTO tagDTO) throws ApiException {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            em.getTransaction().begin();&#10;&#10;            Tag tag = em.find(Tag.class, id);&#10;            if (tag == null) {&#10;                throw new EntityNotFoundException(&quot;Tag with id &quot; + id + &quot; not found&quot;);&#10;            }&#10;&#10;            tag.setName(tagDTO.getName());&#10;&#10;            em.getTransaction().commit();&#10;            return new TagDTO(tag);&#10;        } catch (EntityNotFoundException e) {&#10;            throw new ApiException(404, e.getMessage());&#10;        } catch (Exception e) {&#10;            throw new ApiException(500, &quot;Failed to update tag: &quot; + e.getMessage());&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void delete(Long id) throws ApiException {&#10;        try (EntityManager em = emf.createEntityManager()) {&#10;            em.getTransaction().begin();&#10;            Tag tag = em.find(Tag.class, id);&#10;            if (tag == null) {&#10;                throw new EntityNotFoundException(&quot;Tag with id &quot; + id + &quot; not found&quot;);&#10;            }&#10;            em.remove(tag);&#10;            em.getTransaction().commit();&#10;        } catch (EntityNotFoundException e) {&#10;            throw new ApiException(404, e.getMessage());&#10;        } catch (Exception e) {&#10;            throw new ApiException(500, &quot;Failed to delete tag: &quot; + e.getMessage());&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>